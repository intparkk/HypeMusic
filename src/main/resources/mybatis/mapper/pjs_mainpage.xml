<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.study.springboot.dao.pjs_mainpageDAO">
	
	<!-- 메인페이지 Top10 트랙 -->
	<select id="gettop10tracks" resultType="trackinfoDTO">
	    SELECT *
	    FROM (
	        SELECT
	            t.track_id, 
	            t.artist_id, 
	            t.title, 
	            a.artist, 
	            al.release_date, 
	            t.like_count, 
	            al.album_img
	        FROM tracks t
	        JOIN artists a ON t.artist_id = a.artist_id
	        JOIN albums al ON t.album_id = al.album_id
	        ORDER BY t.like_count DESC
	    )
	    WHERE ROWNUM &lt;= 10
	</select>
	
	<!-- 메인페이지 정면 그리드  -->
	<select id="getRandomTracksByGenre" resultType="trackinfoDTO">
		SELECT t.track_id, t.artist_id, t.title, t.genre, a.artist, al.release_date, al.album_img
		FROM TRACKS t
		JOIN ARTISTS a ON t.artist_id = a.artist_id
		JOIN ALBUMS al ON t.album_id = al.album_id
		WHERE t.genre LIKE '%' || #{genre} || '%'
		  AND al.release_date > TO_DATE('2021-01-01', 'YYYY-MM-DD')
		ORDER BY DBMS_RANDOM.VALUE
	</select>
	
		<!-- 랜덤 아티스트 20명(메인페이지 하단) -->
	<select id="getrandomartists" resultType="trackinfoDTO">
		SELECT artist_id, artist, artist_img
			FROM (
			    SELECT artist_id, artist, artist_img
			    FROM artists
			    WHERE artist_img IS NOT NULL
			    ORDER BY DBMS_RANDOM.VALUE
			)
			WHERE ROWNUM &lt;= 40			
	</select>	
</mapper>