<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.study.springboot.dao.HjsmusicDAO">
	
	<resultMap id="musicResult" type="HjsmusicDTO">
		<result column="track_id" property="track_id" />
		<result column="artist_id" property="artist_id" />
	</resultMap>
	
	
	<select id="totalCount" resultType="int">
		select count(*) from tb_music
	</select>
	
 	 
 	 <select id="selectHjsmusicDTO" 
			resultType="HjsmusicDTO" 
			parameterType="com.study.springboot.dto.HjsmusicDTO">
		select * from (
			SELECT *
			FROM ( 
			 SELECT rownum AS rnum, a.* from(
            select m.*, t.youtube_url
			  FROM tb_music m, tracks t
			  where m.track_id = t.track_id
			  ORDER BY m.like_count DESC
			)a
	 		) 
	 		WHERE rnum <![CDATA[<=]]> 100 
 		)
		WHERE rnum <![CDATA[ >= ]]> #{startNum}
		  AND rnum <![CDATA[ <= ]]> #{endNum}
		
	</select>
 	 
	<select id="listDao" resultType="com.study.springboot.dto.HjsmusicDTO">
		SELECT *
		FROM (
		  SELECT *
		  FROM tb_music
		  ORDER BY like_count DESC
 		) WHERE ROWNUM <![CDATA[<=]]> 100 
	</select>

	<!-- 관리자 곡추가 -->
	<select id="listDao2" resultType="com.study.springboot.dto.HjsmusicDTO">
		SELECT *
		FROM (
		  SELECT *
		  FROM tb_music_test
		  ORDER BY like_count DESC
 		) WHERE ROWNUM <![CDATA[<=]]> 100 
	</select>


	<select id="youtubeDao" resultType="com.study.springboot.dto.HjsmusicDTO">
		select youtube_url 
		from( select * 
		from tb_music m, tracks t
		where m.track_id = t.track_id
		order by m.like_count DESC
		) WHERE ROWNUM <![CDATA[<=]]> 100 
		
	</select>

	
	<select id="viewDao" 
		parameterType="com.study.springboot.dto.HjsmusicDTO"
		resultType="com.study.springboot.dto.HjsmusicDTO">
		
		select * 
		from tb_music
		where track_id= #{track_id}
	</select>
	
	
	<select id="viewDao2" 
		parameterType="com.study.springboot.dto.HjsmusicDTO"
		resultType="com.study.springboot.dto.HjsmusicDTO">

		select * from 
		(SELECT artist, AVG(like_COUNT) AS L_c FROM tb_music 
		GROUP BY artist 
		ORDER BY L_c desc)
		where rownum <![CDATA[<=]]>12
	
	</select>	
	
	
	
	
	<insert id="writeDao" parameterType="com.study.springboot.dto.HjsmusicDTO">
		insert into tb_music (
		track_id,  
		artist_id,   
		album_img,   
		title,  
		artist,  
		album_name,  
		like_count,  
		genre,   
		release_date, 
		lyrics  
		)
		values (
		#{track_id},  
		#{artist_id},   
		#{album_img},   
		#{title},  
		#{artist},  
		#{album_name},  
		#{like_count},  
		#{genre},   
		#{release_date}, 
		#{lyrics}  
		)
	</insert>
   <!-- 관리자 음악 insert위해 생성 -->
	<insert id="writeDao2" parameterType="com.study.springboot.dto.HjsmusicDTO">
		insert into tb_music_test (
		track_id,  
		artist_id,   
		album_img,   
		title,  
		artist,  
		album_name,  
		like_count,  
		genre,   
		release_date, 
		lyrics  
		)
		values (
		#{track_id},  
		#{artist_id},   
		#{album_img},   
		#{title},  
		#{artist},  
		#{album_name},  
		#{like_count},  
		#{genre},   
		#{release_date}, 
		#{lyrics}  
		)
	</insert>
	
	
	<delete id="deleteDao" parameterType="com.study.springboot.dto.HjsmusicDTO">
		DELETE FROM tb_music WHERE track_id= #{track_id}
	</delete>
	
	<delete id="deleteadminDao" parameterType="com.study.springboot.dto.HjsmusicDTO">
	    delete from tb_music_test where track_id= #{track_id}
	</delete>
	
	<update id="updateDao" parameterType="com.study.springboot.dto.HjsmusicDTO">
		UPDATE 
				tb_music
		   SET 
				artist_id = #{artist_id},
				title = #{title},
				artist = #{artist}
		 WHERE 
		 		track_id= #{track_id}
	</update>
	
	<!-- 원본 -->
<!--   	
	<select id="testIf"
		parameterType="com.study.springboot.dto.HjsmusicDTO"
		resultType="com.study.springboot.dto.HjsmusicDTO">
			select * from tb_music
		<where>
	 		<if test=" genre != null and genre !='' ">
				AND genre LIKE '%'||#{genre}||'%'
			</if>
 		</where>
		
 			where genre Like '%'||#{genre}||'%'
 			order by 
			release_date desc
	</select>

 -->

 	<!-- 시간 단축을 위해 위의 코드를 아래의 코드로 수정했습니다.  -->
 	<select id="testIf"
		parameterType="com.study.springboot.dto.HjsmusicDTO"
		resultType="com.study.springboot.dto.HjsmusicDTO">
			select  
			track_id ,genre, album_img, title, artist, album_name, release_date 
			from tb_music
 			where genre Like '%'||#{genre}||'%'
 			order by 
			release_date desc
	</select>

 
</mapper>
